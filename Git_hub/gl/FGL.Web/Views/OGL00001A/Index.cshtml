@model FGL.Web.ViewModels.OGL00001Model

@{
    Layout = "~/Views/Shared/_LayoutFrame.cshtml";
    ViewBag.Title = ViewBag.funcName;
    var opScope = ViewBag.opScope;
}




<div class="container-fluid" id="main">
    <div class="panel panel-primary">
        <div class="panel-heading">@ViewBag.Title</div>
        <div class="panel-body">
            <div id="validationSummary" style="color:red;">
            </div>
            @if (opScope != "" && opScope != "0")
            {
                @Html.Hidden("hidProductType", "")
                @Html.Hidden("hidYNFlag", "")
                @Html.Hidden("hidItemCon", "")
                @Html.Hidden("hidIsIfrs4", "")
                <div class="row">
                    <div id="qryResult" class="col-sm-24">
                        <table id="grid"></table>
                        <div id="pager"></div>
                    </div>
                </div>
            }



        </div>
    </div>

</div>



<script type="text/javascript">
    //轉跳"申請單明細"畫面
    function qryDetail(aplyNo) {
        document.location.href = "/OGL00001A/detailAply/?aplyNo=" + aplyNo;


    }

    //取得"險種類別"下拉選單
    function getProductType() {
        return $('#hidProductType').val();
    }

    //取得"YN"下拉選單
    function getYNFlag() {
        return $('#hidYNFlag').val();
    }

    //取得"合約分類"下拉選單
    function getItemCon() {
        return $('#hidItemCon').val();
    }

    //取得"是否適用 IFRS4"下拉選單
    function getIsIfrs4() {
        return $('#hidIsIfrs4').val();
    }


    $(function () {
        $.unblockUI();
        var opScope = '@Html.Raw(ViewBag.opScope)';

        if (opScope == "" || opScope == "0") {
            $('#validationSummary').children().remove();

            var validationSummary = $('#validationSummary ul.validation-summary-errors');

            if (validationSummary.length == 0) {
                $('#validationSummary').append('<ul class="validation-summary-errors"></ul>');
                validationSummary = $('#validationSummary ul.validation-summary-errors');
            }
            validationSummary.append('<li>' + '無使用權限' + '</li>');

        } else {
            $('#hidProductType').val('@Html.Raw(ViewBag.productTypejqList)');
            $('#hidYNFlag').val('@Html.Raw(ViewBag.ynjqList)');
            $('#hidItemCon').val('@Html.Raw(ViewBag.itemConjqList)');
            $('#hidIsIfrs4').val('@Html.Raw(ViewBag.isIfrs4jqList)');

            createGrid();
        }



        //*--------------查詢待覆核資料  begin-----------------*//
        function createGrid() {


            $('#qryResult').children().remove();

            $('#qryResult').append('<table id="' + "grid" + '"></table>');
            $('#qryResult').append('<div id="' + "pager" + '"></div>');



            $.blockUI(); //畫面鎖起來

            $("#grid").jqGrid({
                url: '/OGL00001A/LoadData/',
               // postData: para,
                datatype: 'json',
                jsonReader: {
                    repeatitems: false, id: 'aplyNo'
                },
                mtype: 'POST',
                colModel: [
                {
                    label: '覆核單編號',
                    name: 'aplyNo', align: 'center',
                    editable: false,
                    formatter: function (cellvalue, options, rowObject) {
                        var aplyNo = rowObject.aplyNo;
                        // return '<a style="color:Blue;text-decoration:underline;" href="/FGL10181A/detailAply/?aplyNo=' + options.rowId + ' ">' + cellvalue.trim() + '</a>';
                        return '<a href="javascript:qryDetail(\'' + options.rowId + '\')" style="color: #3366ff" id="' + options.rowId + '" >' + cellvalue.trim() + '</a>';

                    }
                },
               {
                   label: '險種類別',
                   name: 'productType', align: 'left',
                   editable: true,
                   edittype: "select",
                   formatter: 'select',
                   editoptions: {
                       value: getProductType()
                   }

               },

               {
                   label: '外幣註記',
                   name: 'fuMk', align: 'center',
                   editable: true,
                   edittype: "select",
                   formatter: 'select',
                   editoptions: {
                       value: getYNFlag()
                   }

               },
               {
                   label: '合約分類',
                   name: 'itemCon', align: 'center',
                   editable: true,
                   edittype: "select",
                   formatter: 'select',
                   editoptions: {
                       value: getItemCon()
                   }
               },
               {
                   label: '裁量參與特性',
                   name: 'discPartFeat', align: 'center',
                   editable: true,
                   edittype: "select",
                   formatter: 'select',
                   editoptions: {
                       value: getYNFlag()
                   }
               },
               {
                   label: '是否適用 IFRS4',
                   name: 'isIfrs4', align: 'center',
                   editable: true,
                   edittype: "select",
                   formatter: 'select',
                   editoptions: {
                       value: getIsIfrs4()
                   }
               },
               {
                   label: '申請人',
                   name: 'lastUpdateUid', align: 'center',
                   editable: false
               },
                {
                    label: '申請日期',
                    name: 'lastUpdateDT', align: 'center',
                    editable: false
                }
                ],

                autowidth: true,
                shrinkToFit: false,
                forceFit: true,
                pager: '#pager',
                width: 'auto',
                height: 'auto',
                rowNum: 10,
                rowList: [10, 20],
                sortname: 'aplyNo',
                sortorder: "acs",
                viewrecords: true,
                loadonce: true,
                loadComplete: function () {
                    var cnt = $('#grid').getGridParam('records')
                    $('#validationSummary').children().remove();

                    if (cnt == 0) {


                        var validationSummary = $('#validationSummary ul.validation-summary-errors');

                        if (validationSummary.length == 0) {
                            $('#validationSummary').append('<ul class="validation-summary-errors"></ul>');
                            validationSummary = $('#validationSummary ul.validation-summary-errors');
                        }
                        validationSummary.append('<li>' + '無符合條件的資料!!' + '</li>');

                    }
                }

            });

            $.unblockUI(); //畫面打開
        }

        //*--------------查詢待覆核資料  end-----------------*//







    });
</script>


